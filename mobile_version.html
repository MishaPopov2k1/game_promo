<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ö–ê–ñ–ï–¢–°–Ø - –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(180deg, 
                rgba(44, 62, 80, 0.9) 0%, 
                rgba(52, 73, 94, 0.8) 50%, 
                rgba(44, 62, 80, 0.9) 100%),
                url('public/images/dozhd_kapli_steklo_348253_3840x2400.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç */
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 480px;
            margin: 0 auto;
            background: linear-gradient(180deg, 
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.1) 50%,
                rgba(0, 0, 0, 0.4) 100%);
            overflow: hidden;
        }

        /* Canvas –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* –ò–≥—Ä–æ–∫ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ */
        #player {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px; /* –ï—â–µ –±–æ–ª—å—à–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º */
            height: 100px; /* –ï—â–µ –±–æ–ª—å—à–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º */
            z-index: 10;
            transition: left 0.3s ease;
        }

        .runner {
            width: 100%;
            height: 100%;
            background-image: url('public/images/HABBA_HERO.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            /* –£–±–∏—Ä–∞–µ–º –í–°–ï —Ä–∞–º–∫–∏ –∏ —Ç–µ–Ω–∏ */
            animation: idleWiggle 3s ease-in-out infinite;
            image-rendering: pixelated; /* –ß–µ—Ç–∫–∏–µ –ø–∏–∫—Å–µ–ª–∏ */
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—à–∞—Ç—ã–≤–∞–Ω–∏—è –∫–∞–∫ –≤ —Ä–æ–≥–∞–ª–∏–∫ –∏–≥—Ä–∞—Ö */
        @keyframes idleWiggle {
            0% { 
                transform: translateY(0px) translateX(0px) rotate(0deg); 
            }
            25% { 
                transform: translateY(-2px) translateX(1px) rotate(0.5deg); 
            }
            50% { 
                transform: translateY(-1px) translateX(-1px) rotate(-0.3deg); 
            }
            75% { 
                transform: translateY(-3px) translateX(0.5px) rotate(0.2deg); 
            }
            100% { 
                transform: translateY(0px) translateX(0px) rotate(0deg); 
            }
        }
        
        /* –°—Ç–∞—Ä–∞—è –∞–Ω–∏–º–∞—Ü–∏—è (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞) */
        /* @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        } */

        /* –°—Ç—Ä–æ–∫–∏ —Ç–µ–∫—Å—Ç–∞ - –ø–∞–¥–∞—é—Ç —Å–≤–µ—Ä—Ö—É —Å –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º–∏ —Ä–∞–º–æ—á–∫–∞–º–∏ */
        .lyric-phrase {
            position: absolute;
            top: -50px;
            padding: 12px 20px;
            border-radius: 8px; /* –õ–µ–≥–∫–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç–∏ */
            font-size: 18px;
            font-weight: 900;
            color: #ffffff;
            text-align: center;
            z-index: 5;
            animation: fallDown 7s linear forwards; /* –£–±–∏—Ä–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            cursor: pointer;
            /* backdrop-filter: blur(5px); */ /* –£–±–∏—Ä–∞–µ–º blur –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            
            /* –ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è –ø—Ä–æ—Å—Ç–∞—è —Ä–∞–º–æ—á–∫–∞ */
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                inset 1px 1px 0 rgba(255, 255, 255, 0.2);
            
            max-width: 320px;
            line-height: 1.3;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7);
            transition: all 0.3s ease;
        }
        
        .lyric-phrase:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 255, 255, 0.3);
        }
        
        /* @keyframes phraseGlow - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        @keyframes phraseGlow {
            0% { 
                box-shadow: 
                    0 8px 25px rgba(0, 0, 0, 0.4),
                    0 0 0 rgba(255, 255, 255, 0);
            }
            100% { 
                box-shadow: 
                    0 8px 25px rgba(0, 0, 0, 0.4),
                    0 0 20px rgba(255, 255, 255, 0.4),
                    inset 0 0 20px rgba(255, 255, 255, 0.1);
            }
        } */

        /* –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∏–ø–æ–≤ —Å—Ç—Ä–æ–∫ - –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –¥–æ–∂–¥–ª–∏–≤—ã–µ —Ü–≤–µ—Ç–∞ */
        .lyric-phrase.verse {
            background: linear-gradient(135deg, 
                rgba(70, 130, 180, 0.85), 
                rgba(100, 149, 237, 0.75));
            font-size: 18px;
            border-color: rgba(70, 130, 180, 0.6);
            box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4);
        }

        .lyric-phrase.chorus {
            background: linear-gradient(135deg, 
                rgba(106, 90, 205, 0.85), 
                rgba(123, 104, 238, 0.75));
            font-size: 20px;
            border-color: rgba(106, 90, 205, 0.6);
            box-shadow: 0 6px 25px rgba(106, 90, 205, 0.5);
        }

        .lyric-phrase.intro {
            background: linear-gradient(135deg, 
                rgba(95, 158, 160, 0.85), 
                rgba(72, 209, 204, 0.75));
            font-size: 19px;
            border-color: rgba(95, 158, 160, 0.6);
            box-shadow: 0 6px 22px rgba(95, 158, 160, 0.45);
        }



        @keyframes fallDown {
            0% {
                top: -50px;
                opacity: 0;
                transform: scale(0.7) rotateX(-10deg);
                filter: blur(2px) brightness(0.8);
            }
            10% {
                opacity: 0.8;
                transform: scale(0.9) rotateX(-5deg);
                filter: blur(1px) brightness(0.9);
            }
            20% {
                opacity: 1;
                transform: scale(1) rotateX(0deg);
                filter: blur(0px) brightness(1);
            }
            80% {
                opacity: 1;
                transform: scale(1) rotateX(0deg);
                filter: blur(0px) brightness(1);
            }
            95% {
                opacity: 0.6;
                transform: scale(0.9) rotateX(5deg);
                filter: blur(1px) brightness(0.9);
            }
            100% {
                top: 100vh;
                opacity: 0;
                transform: scale(0.7) rotateX(10deg);
                filter: blur(2px) brightness(0.7);
            }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ —Å–±–æ—Ä–µ */
        .collected-phrase {
            animation: collect 1.4s ease-out forwards !important;
            z-index: 15 !important;
            pointer-events: none;
        }

        /* –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞ –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
        @keyframes collect {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
                color: inherit;
            }
            30% {
                opacity: 1;
                transform: scale(1.3) translateY(-15px);
                color: #ffd700;
            }
            70% {
                opacity: 0.5;
                transform: scale(0.8) translateY(-40px);
                color: #ffffff;
            }
            100% {
                opacity: 0;
                transform: scale(0.2) translateY(-80px);
                color: #ffffff;
            }
        }

        /* –ß–∞—Å—Ç–∏—Ü—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .collect-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.95), 
                rgba(70, 130, 180, 0.7), 
                rgba(95, 158, 160, 0.4));
            border-radius: 50%;
            pointer-events: none;
            z-index: 12;
            animation: particle 1.2s ease-out forwards;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
        }

        @keyframes particle {
            0% {
                opacity: 1;
                transform: scale(1) translate(0, 0) rotate(0deg);
                filter: blur(0px) brightness(1);
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
            }
            30% {
                opacity: 0.9;
                transform: scale(1.5) translate(calc(var(--dx) * 0.3), calc(var(--dy) * 0.3)) rotate(90deg);
                filter: blur(0.5px) brightness(1.3);
                box-shadow: 0 0 15px rgba(70, 130, 180, 0.8);
            }
            70% {
                opacity: 0.5;
                transform: scale(2) translate(calc(var(--dx) * 0.7), calc(var(--dy) * 0.7)) rotate(180deg);
                filter: blur(1px) brightness(1.6);
                box-shadow: 0 0 20px rgba(95, 158, 160, 0.7);
            }
            100% {
                opacity: 0;
                transform: scale(3) translate(var(--dx), var(--dy)) rotate(270deg);
                filter: blur(2px) brightness(2);
                box-shadow: 0 0 25px rgba(123, 104, 238, 0.5);
            }
        }

        /* UI —ç–ª–µ–º–µ–Ω—Ç—ã */
        .ui-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 20;
        }

        .score-info {
            background: rgba(44, 62, 80, 0.6);
            padding: 10px 15px;
            border-radius: 20px;
            color: #ecf0f1;
            font-size: 14px;
            /* backdrop-filter: blur(8px); */ /* –£–±–∏—Ä–∞–µ–º blur –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            border: 2px solid rgba(70, 130, 180, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 2px;
            z-index: 20;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(70, 130, 180, 0.9), 
                rgba(95, 158, 160, 0.9), 
                rgba(106, 90, 205, 0.9));
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(70, 130, 180, 0.6);
        }

        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #startScreen h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(173, 216, 230, 0.8);
            letter-spacing: 3px;
        }

        .subtitle {
            font-size: 1.1em;
            margin-bottom: 30px;
            opacity: 0.9;
            color: #bdc3c7;
        }

        .mobile-instructions {
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 40px;
            opacity: 0.8;
            max-width: 300px;
        }

        #startBtn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            transition: all 0.3s ease;
        }

        #startBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.6);
        }

        /* –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã */
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #gameOver h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #3498db;
        }

        .final-stats {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        #restartBtn {
            padding: 12px 25px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* –î–æ–∂–¥–µ–≤—ã–µ –∫–∞–ø–ª–∏ */
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, rgba(135, 206, 235, 0.6));
            animation: rainFall 2s linear infinite;
            z-index: 2;
        }

        @keyframes rainFall {
            0% { top: -20px; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100vh; opacity: 0; }
        }

        /* –ö–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è –º–æ–±–∏–ª–∫–∏ */
        .mobile-controls {
            position: absolute;
            bottom: 140px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 15;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(70, 130, 180, 0.4);
            border: 2px solid rgba(70, 130, 180, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ecf0f1;
            font-size: 20px;
            /* backdrop-filter: blur(8px); */ /* –£–±–∏—Ä–∞–µ–º blur –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.9);
            background: rgba(70, 130, 180, 0.6);
            box-shadow: 0 6px 20px rgba(70, 130, 180, 0.5);
        }

        /* –ü–∞–Ω–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .sync-panel {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 25;
            /* backdrop-filter: blur(8px); */ /* –£–±–∏—Ä–∞–µ–º blur –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: none;
        }

        .sync-panel button {
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 2px;
            cursor: pointer;
            font-size: 11px;
        }

        .sync-panel button:hover {
            background: rgba(52, 152, 219, 1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-2-phrase {
            animation: level2Fall 6.5s linear forwards;
        }

        @keyframes level2Fall {
            0% {
                top: -50px;
                opacity: 0;
                transform: scale(0.8) rotate(-15deg);
                filter: hue-rotate(0deg);
            }
            10% {
                opacity: 1;
                transform: scale(1) rotate(-10deg);
                filter: hue-rotate(30deg);
            }
            50% {
                transform: scale(1.1) rotate(0deg);
                filter: hue-rotate(60deg);
            }
            90% {
                opacity: 1;
                transform: scale(1) rotate(10deg);
                filter: hue-rotate(90deg);
            }
            100% {
                top: 100vh;
                opacity: 0;
                transform: scale(0.8) rotate(15deg);
                filter: hue-rotate(120deg);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-3-phrase {
            animation: level3Fall 4.5s linear forwards;
        }

        @keyframes level3Fall {
            0% {
                top: -50px;
                opacity: 0;
                transform: scale(0.8) rotate(-20deg) skew(-3deg);
                filter: hue-rotate(0deg) saturate(1.8) brightness(1.1);
            }
            15% {
                opacity: 1;
                transform: scale(1.05) rotate(-10deg) skew(-1deg);
                filter: hue-rotate(45deg) saturate(2) brightness(1.2);
            }
            35% {
                transform: scale(0.95) rotate(0deg) skew(0deg);
                filter: hue-rotate(90deg) saturate(2.2) brightness(1.3);
            }
            55% {
                transform: scale(1.1) rotate(10deg) skew(1deg);
                filter: hue-rotate(180deg) saturate(2.4) brightness(1.4);
            }
            75% {
                transform: scale(1) rotate(20deg) skew(2deg);
                filter: hue-rotate(270deg) saturate(2.6) brightness(1.5);
            }
            90% {
                opacity: 1;
                transform: scale(1.05) rotate(30deg) skew(3deg);
                filter: hue-rotate(315deg) saturate(2.8) brightness(1.6);
            }
            100% {
                top: 100vh;
                opacity: 0;
                transform: scale(0.8) rotate(40deg) skew(5deg);
                filter: hue-rotate(360deg) saturate(3) brightness(1.7);
            }
        }

        /* –ò–¥–µ–∏ */
        .coin {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, 
                #ffd700 0%, 
                #ffed4e 25%, 
                #f39c12 50%, 
                #e67e22 75%, 
                #d35400 100%);
            border-radius: 50%;
            border: 2px solid #f1c40f;
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.8),
                inset 0 2px 4px rgba(255, 255, 255, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.3);
            z-index: 6;
            animation: coinFall 4s linear forwards;
            cursor: pointer;
        }

        .coin::before {
            content: 'üí∞';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            animation: coinSpin 1s linear infinite;
        }

        @keyframes coinSpin {
            0% { transform: translate(-50%, -50%) rotateY(0deg); }
            50% { transform: translate(-50%, -50%) rotateY(180deg) scaleX(-1); }
            100% { transform: translate(-50%, -50%) rotateY(360deg); }
        }

        @keyframes coinFall {
            0% {
                top: -50px;
                opacity: 0;
                transform: scale(0.8);
                filter: brightness(1);
            }
            10% {
                opacity: 1;
                transform: scale(1);
                filter: brightness(1.2);
            }
            90% {
                opacity: 1;
                transform: scale(1);
                filter: brightness(1.2);
            }
            100% {
                top: 100vh;
                opacity: 0;
                transform: scale(0.8);
                filter: brightness(1);
            }
        }

        .coin-collected {
            animation: coinCollect 0.8s ease-out forwards !important;
            z-index: 20 !important;
            pointer-events: none;
        }

        @keyframes coinCollect {
            0% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
                filter: brightness(1.2);
            }
            30% {
                opacity: 1;
                transform: scale(1.5) rotate(180deg);
                filter: brightness(2);
            }
            70% {
                opacity: 0.8;
                transform: scale(2) rotate(360deg);
                filter: brightness(3);
            }
            100% {
                opacity: 0;
                transform: scale(3) rotate(540deg);
                filter: brightness(4);
            }
        }

        .level-transition {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(106, 90, 205, 0.9), rgba(123, 104, 238, 0.8));
            color: white;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            animation: levelTransition 3s ease-out forwards;
            box-shadow: 0 10px 30px rgba(106, 90, 205, 0.6);
        }

        @keyframes levelTransition {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="480" height="800"></canvas>
        
        <!-- –ò–≥—Ä–æ–∫ -->
        <div id="player">
            <div class="runner"></div>
        </div>
        
        <!-- UI –ø–∞–Ω–µ–ª—å -->
        <div class="ui-panel">
            <div class="score-info">
                <div>–°–æ–±—Ä–∞–Ω–æ: <span id="collectedCount">0</span></div>
                <div>–ö–æ–º–±–æ: <span id="comboCount">1</span>x</div>
            </div>
            <div class="score-info">
                <div>–û—á–∫–∏: <span id="scoreCount">0</span></div>
                <div style="color: #3498db;">–£—Ä–æ–≤–µ–Ω—å: <span id="levelIndicator">1</span></div>
            </div>
            <div class="score-info" id="coinPanel">
                <div style="color: #f1c40f;">üí° –ò–¥–µ–π: <span id="coinCount">0</span></div>
            </div>
            <div class="score-info">
                <button onclick="toggleSyncPanel()" style="background: rgba(52,152,219,0.8); color: white; border: none; padding: 5px; border-radius: 5px; font-size: 10px;">üéµ –°–∏–Ω—Ö—Ä</button>
            </div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="mobile-controls">
            <div class="control-btn" id="leftBtn">‚Üê</div>
            <div class="control-btn" id="rightBtn">‚Üí</div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã) -->
        <div class="sync-panel" id="syncPanel">
            <div>üéµ –í—Ä–µ–º—è: <span id="currentTime">0:00</span></div>
            <div>–°–ª–µ–¥—É—é—â–∞—è —Ñ—Ä–∞–∑–∞: <span id="nextPhrase">-</span></div>
            <div>–ß–µ—Ä–µ–∑: <span id="timeToNext">-</span>—Å</div>
            <button onclick="toggleSyncPanel()">–°–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="startScreen">
        <h1>–ö–ê–ñ–ï–¢–°–Ø</h1>
        <div class="subtitle">–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è | habba-po</div>
        <div class="mobile-instructions">
            üì± –°—Ç—Ä–æ—á–∫–∏ –ø–∞–¥–∞—é—Ç —Å–≤–µ—Ä—Ö—É<br>
            üí° –°–æ–±–∏—Ä–∞–π –Ω–æ–≤—ã–µ –∏–¥–µ–∏ ‚Äî –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å!<br>
            üíô –¢–∞–∫–∂–µ —Å–æ–±–∏—Ä–∞–π —Ñ—Ä–∞–∑—ã —Ç—Ä–µ–∫–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É<br>
            üéµ 3 —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ä–∞–∑–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π –∏–¥–µ–π<br>
            üëÜ –¢–∞–ø–∞–π –∏–ª–∏ —Å–≤–∞–π–ø–∞–π –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ<br>
            ‚ú® –ü–æ—á—É–≤—Å—Ç–≤—É–π —Ä–∏—Ç–º –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É
        </div>
        <button id="startBtn">üé¨ –°–¢–ê–†–¢</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è -->
    <div id="gameOver">
        <h2>–¢—Ä–µ–∫ –ø—Ä–æ—Å–ª—É—à–∞–Ω!</h2>
        <div class="final-stats">
            <div>–°–æ–±—Ä–∞–Ω–æ —Ñ—Ä–∞–∑: <span id="finalCollected">0</span></div>
            <div>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="finalScore">0</span></div>
            <div>–ú–∞–∫—Å. –∫–æ–º–±–æ: <span id="finalCombo">1</span></div>
            <div style="color: #3498db;">–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç: <span id="finalLevel">1</span></div>
            <div style="color: #f1c40f;">üí° –ò–¥–µ–π: <span id="finalCoins">0</span></div>
        </div>
        <button id="restartBtn">üîÑ –ï–©–Å –†–ê–ó</button>
    </div>

    <!-- –ê—É–¥–∏–æ -->
    <audio id="backgroundMusic" preload="auto">
        <source src="music/kazhetsya/m4a/–∫–∞–∂–µ—Ç—Å—è2.m4a" type="audio/mp4">
        <p>–ú—É–∑—ã–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
    </audio>

    <script>
        // –†–∞–∑–±–∏—Ç—ã–µ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã —Å—Ç—Ä–æ–∫–∏ —Ç—Ä–µ–∫–∞
        const trackPhrases = [
            // –ü—Ä–∏–ø–µ–≤ 1 (3 —Å–µ–∫)
            { text: "–ö–∞–∂–µ—Ç—Å—è", timing: 3, type: "chorus", order: 1 },
            { text: "–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–∂–¥—å", timing: 4, type: "chorus", order: 2 },
            { text: "–î–∞–∂–µ —Å–µ–π—á–∞—Å –ª–µ—Ç–æ–º", timing: 6, type: "chorus", order: 3 },
            { text: "–ø–æ–¥ –¥–æ–∂–¥–µ–º –º—ã –±–µ–≥–∞–µ–º", timing: 7.5, type: "chorus", order: 4 },
            { text: "–∫–∞–∫ –¥–µ—Ç–∏", timing: 8.5, type: "chorus", order: 5 },
            { text: "–ü–æ–∫–∞ –≤—Ä–µ–º—è", timing: 9.5, type: "chorus", order: 6 },
            { text: "–ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å", timing: 10.5, type: "chorus", order: 7 },
            { text: "–°–æ—Ö—Ä–∞–Ω—é —Ç–µ–ø–ª–æ –∏ –ø–∞–º—è—Ç—å", timing: 12, type: "chorus", order: 8 },
            { text: "–Ω–∞ —ç—Ç–æ–º –∫—É–ø–ª–µ—Ç–µ", timing: 13.5, type: "chorus", order: 9 },
            
            // –ö—É–ø–ª–µ—Ç 1
            { text: "–ß—Ç–æ —Å–º—ã–≤–∞–µ—Ç –¥–æ–∂–¥—å,", timing: 15, type: "verse", order: 10 },
            { text: "–∞ —Å–∫–∞–∂–∏ –º–Ω–µ?", timing: 16, type: "verse", order: 11 },
            { text: "–ú–æ–∂–µ—Ç –±—ã—Ç—å, —Å–ª–µ–¥—ã –æ—à–∏–±–æ–∫", timing: 18, type: "verse", order: 12 },
            { text: "–∏–ª–∏ –ª–∏—Ü–∞, —á—Ç–æ –∑–∞–±—ã–ª–∏", timing: 19.5, type: "verse", order: 13 },
            { text: "–ú–æ–∂–µ—Ç –±—ã—Ç—å, —Å–ª–æ–≤–∞,", timing: 21, type: "verse", order: 14 },
            { text: "—á—Ç–æ –Ω–µ —Å–∫–∞–∑–∞–ª–∏", timing: 22, type: "verse", order: 15 },
            { text: "–º—ã—Å–ª–∏, —á—Ç–æ –Ω–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏", timing: 23.5, type: "verse", order: 16 },
            { text: "–ò–ª–∏ –≤—Å–µ –≥—Ä–µ—Ö–∏,", timing: 24, type: "verse", order: 17 },
            { text: "—á—Ç–æ–±—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ", timing: 25, type: "verse", order: 18 },
            { text: "—Å—Ç–∞—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–º", timing: 26, type: "verse", order: 19 },
            
            { text: "–ü–æ–º–Ω—é –Ω–∞ –≤–µ—Ä–∞–Ω–¥–µ —Å –¥–µ–¥–æ–º,", timing: 27, type: "verse", order: 20 },
            { text: "–Ω–∞–±–ª—é–¥–∞–ª–∏ –Ω–µ–±–æ", timing: 28.5, type: "verse", order: 21 },
            { text: "–ö–∞–∫ –æ–Ω–æ —á–µ—Ä–Ω–µ–ª–æ,", timing: 30, type: "verse", order: 22 },
            { text: "–∞ –≤–æ–∑–¥—É—Ö —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Å–≤–µ–∂–∏–º", timing: 31.5, type: "verse", order: 23 },
            { text: "–ú—ã –º–æ–ª—á–∞ —Å–∏–¥–µ–ª–∏", timing: 33, type: "verse", order: 24 },
            { text: "—Å–ª—É—à–∞—è –ø–æ—Ä—ã–≤—ã –≤–µ—Ç—Ä–∞", timing: 34.5, type: "verse", order: 25 },
            { text: "–Ø –ø—Ä–æ—à—É, –±—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤,", timing: 36, type: "verse", order: 26 },
            { text: "–≥–¥–µ –±—ã —Ç—ã —Ç–∞–º –Ω–∏ –±—ã–ª", timing: 37.5, type: "verse", order: 27 },
            
            // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∫—É–ø–ª–µ—Ç–∞ 1
            { text: "–¢–µ–ø–µ—Ä—å —è —Å–∏–∂—É –Ω–∞ —Ç–æ–º –∂–µ –º–µ—Å—Ç–µ,", timing: 40, type: "verse", order: 28 },
            { text: "–∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–∞–º", timing: 41.5, type: "verse", order: 29 },
            { text: "–ì–¥–µ –º–æ–π –¥–µ–¥ —á–∏—Ç–∞–ª –ø–æ–≥–æ–¥—É", timing: 43, type: "verse", order: 30 },
            { text: "–ø–æ —ç—Ç–∏–º –æ–±–ª–∞–∫–∞–º", timing: 44.5, type: "verse", order: 31 },
            { text: "–û–Ω –ø–µ—Ä–µ–¥–∞–ª –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–∞–º—è—Ç—å,", timing: 46, type: "verse", order: 32 },
            { text: "–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å", timing: 47.5, type: "verse", order: 33 },
            { text: "–ü—Ä–∞–≤–¥–∞ –≤ —Ç–æ–º, —á—Ç–æ –¥–æ–∂–¥—å –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç,", timing: 49, type: "verse", order: 34 },
            { text: "—á—Ç–æ –µ–º—É —Å–º—ã–≤–∞—Ç—å", timing: 50.5, type: "verse", order: 35 },
            
            // –ü—Ä–∏–ø–µ–≤ 2 (52 —Å–µ–∫)
            { text: "–ö–∞–∂–µ—Ç—Å—è", timing: 52, type: "chorus", order: 36 },
            { text: "–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–∂–¥—å", timing: 53, type: "chorus", order: 37 },
            { text: "–î–∞–∂–µ —Å–µ–π—á–∞—Å –ª–µ—Ç–æ–º", timing: 55, type: "chorus", order: 38 },
            { text: "–ø–æ–¥ –¥–æ–∂–¥–µ–º –º—ã –±–µ–≥–∞–µ–º", timing: 56.5, type: "chorus", order: 39 },
            { text: "–∫–∞–∫ –¥–µ—Ç–∏", timing: 57.5, type: "chorus", order: 40 },
            { text: "–ü–æ–∫–∞ –≤—Ä–µ–º—è", timing: 58.5, type: "chorus", order: 41 },
            { text: "–ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å", timing: 59.5, type: "chorus", order: 42 },
            { text: "–°–æ—Ö—Ä–∞–Ω—é —Ç–µ–ø–ª–æ –∏ –ø–∞–º—è—Ç—å", timing: 61, type: "chorus", order: 43 },
            { text: "–Ω–∞ —ç—Ç–æ–º –∫—É–ø–ª–µ—Ç–µ", timing: 62.5, type: "chorus", order: 44 },
            
            // –ü—Ä–∏–ø–µ–≤ 3 (1:06 = 66 —Å–µ–∫)
            { text: "–ö–∞–∂–µ—Ç—Å—è", timing: 66, type: "chorus", order: 45 },
            { text: "–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–∂–¥—å", timing: 67, type: "chorus", order: 46 },
            { text: "–î–∞–∂–µ —Å–µ–π—á–∞—Å –ª–µ—Ç–æ–º", timing: 69, type: "chorus", order: 47 },
            { text: "–ø–æ–¥ –¥–æ–∂–¥–µ–º –º—ã –±–µ–≥–∞–µ–º", timing: 70.5, type: "chorus", order: 48 },
            { text: "–∫–∞–∫ –¥–µ—Ç–∏", timing: 71.5, type: "chorus", order: 49 },
            { text: "–ü–æ–∫–∞ –≤—Ä–µ–º—è", timing: 72.5, type: "chorus", order: 50 },
            { text: "–ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å", timing: 73.5, type: "chorus", order: 51 },
            { text: "–°–æ—Ö—Ä–∞–Ω—é —Ç–µ–ø–ª–æ –∏ –ø–∞–º—è—Ç—å", timing: 75, type: "chorus", order: 52 },
            { text: "–Ω–∞ —ç—Ç–æ–º –∫—É–ø–ª–µ—Ç–µ", timing: 76.5, type: "chorus", order: 53 },
            
            // –ö—É–ø–ª–µ—Ç 2 (1:17 = 77 —Å–µ–∫)
            { text: "–í—Å–µ –ø—Ä–æ–π–¥–µ—Ç,", timing: 77, type: "verse", order: 54 },
            { text: "—è —Å–æ—Ö—Ä–∞–Ω—é —ç—Ç–æ –Ω–∞–¥–æ–ª–≥–æ", timing: 78.5, type: "verse", order: 55 },
            { text: "–Ø —É–º–µ—é –∂–¥–∞—Ç—å,", timing: 80, type: "verse", order: 56 },
            { text: "–Ω–æ –Ω–µ –ø—ã–ª—è—Ç—Å—è –º–æ–∏ –ø–æ–ª–∫–∏", timing: 81.5, type: "verse", order: 57 },
            { text: "–û—á–µ–Ω—å —è—Ä–∫–∏–π —Å–≤–µ—Ç –æ—Ç —Å–æ–ª–Ω—Ü–∞", timing: 83, type: "verse", order: 58 },
            { text: "–¥–∞–∂–µ –ø–æ—Å–ª–µ —à—Ç–æ—Ä–º–∞", timing: 84.5, type: "verse", order: 59 },
            { text: "–î–∞, –º—ã –≤–µ—Ä–∏–º –≤ –ª—É—á—à–µ–µ,", timing: 86, type: "verse", order: 60 },
            { text: "—Ö–æ—Ç—å –Ω–∞—Ç–≤–æ—Ä–∏–ª–∏ –º–Ω–æ–≥–æ", timing: 87.5, type: "verse", order: 61 },
            
            { text: "–ò –¥–∞, –±—ã–ª —Ä–∞–Ω–µ–Ω –≤ —Å–ø–∏–Ω—É,", timing: 89, type: "verse", order: 62 },
            { text: "—Ö–æ—Ç—å –∏ –±—ã–ª –Ω–µ –≤–∏–Ω–æ–≤–∞—Ç", timing: 90.5, type: "verse", order: 63 },
            { text: "–ñ–∏–∑–Ω—å ‚Äî –∏–≥—Ä–∞, —ç—Ç–æ –Ω–µ —Ñ–∏–ª—å–º,", timing: 92, type: "verse", order: 64 },
            { text: "—Ç—É—Ç –Ω—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å", timing: 93.5, type: "verse", order: 65 },
            { text: "–ú—ã —É–º–µ–µ–º –ª—é–±–∏—Ç—å —Å–∏–ª—å–Ω–æ,", timing: 95, type: "verse", order: 66 },
            { text: "–Ω–æ –Ω–∞–º —Ç—Ä—É–¥–Ω–æ –æ—Ç–ø—É—Å–∫–∞—Ç—å", timing: 96.5, type: "verse", order: 67 },
            { text: "–°–æ–±–µ—Ä—É –≤—Å–µ —Å–∏–ª—ã,", timing: 98, type: "verse", order: 68 },
            { text: "–ø—É—â—É –≤–µ—Ç–µ—Ä –≤ –ø–∞—Ä—É—Å–∞", timing: 99.5, type: "verse", order: 69 },
            
            // –ü—Ä–∏–ø–µ–≤ 4 (1:41 = 101 —Å–µ–∫)
            { text: "–ö–∞–∂–µ—Ç—Å—è", timing: 101, type: "chorus", order: 70 },
            { text: "–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–∂–¥—å", timing: 102, type: "chorus", order: 71 },
            { text: "–î–∞–∂–µ —Å–µ–π—á–∞—Å –ª–µ—Ç–æ–º", timing: 104, type: "chorus", order: 72 },
            { text: "–ø–æ–¥ –¥–æ–∂–¥–µ–º –º—ã –±–µ–≥–∞–µ–º", timing: 105.5, type: "chorus", order: 73 },
            { text: "–∫–∞–∫ –¥–µ—Ç–∏", timing: 106.5, type: "chorus", order: 74 },
            { text: "–ü–æ–∫–∞ –≤—Ä–µ–º—è", timing: 107.5, type: "chorus", order: 75 },
            { text: "–ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å", timing: 108.5, type: "chorus", order: 76 },
            { text: "–°–æ—Ö—Ä–∞–Ω—é —Ç–µ–ø–ª–æ –∏ –ø–∞–º—è—Ç—å", timing: 110, type: "chorus", order: 77 },
            { text: "–Ω–∞ —ç—Ç–æ–º –∫—É–ø–ª–µ—Ç–µ", timing: 111.5, type: "chorus", order: 78 },
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–ø–µ–≤ (1:54 = 114 —Å–µ–∫)
            { text: "–ö–∞–∂–µ—Ç—Å—è", timing: 114, type: "chorus", order: 79 },
            { text: "–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–∂–¥—å", timing: 115, type: "chorus", order: 80 },
            { text: "–î–∞–∂–µ —Å–µ–π—á–∞—Å –ª–µ—Ç–æ–º", timing: 117, type: "chorus", order: 81 },
            { text: "–ø–æ–¥ –¥–æ–∂–¥–µ–º –º—ã –±–µ–≥–∞–µ–º", timing: 118.5, type: "chorus", order: 82 },
            { text: "–∫–∞–∫ –¥–µ—Ç–∏", timing: 119.5, type: "chorus", order: 83 },
            { text: "–ü–æ–∫–∞ –≤—Ä–µ–º—è", timing: 120.5, type: "chorus", order: 84 },
            { text: "–ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è —Å–∫–≤–æ–∑—å", timing: 121.5, type: "chorus", order: 85 },
            { text: "–°–æ—Ö—Ä–∞–Ω—é —Ç–µ–ø–ª–æ –∏ –ø–∞–º—è—Ç—å", timing: 123, type: "chorus", order: 86 },
            { text: "–Ω–∞ —ç—Ç–æ–º –∫—É–ø–ª–µ—Ç–µ", timing: 124.5, type: "chorus", order: 87 },
            

        ];

        let game = {
            score: 0,
            combo: 1,
            maxCombo: 1,
            collected: 0,
            coins: 0, // —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∏–¥–µ–∏
            playerX: 50, // –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞
            phrases: [], // –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            coinElements: [], // –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–¥–µ–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            rainDrops: [],
            isRunning: false,
            canvas: null,
            ctx: null,
            gameTime: 0,
            currentPhraseIndex: 0,
            expectedOrder: 1, // –∫–∞–∫—É—é —Ñ—Ä–∞–∑—É –∂–¥–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
            lastCollectTime: 0,
            level: 1, // —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å (1, 2 –∏–ª–∏ 3)
            levelChanged: false, // —Ñ–ª–∞–≥ —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è
            level3Started: false // —Ñ–ª–∞–≥ –¥–ª—è 3-–≥–æ —É—Ä–æ–≤–Ω—è
        };

        function initGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            game.canvas = canvas;
            game.ctx = ctx;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
            const container = document.getElementById('gameContainer');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            const music = document.getElementById('backgroundMusic');
            music.addEventListener('ended', endGame);
            music.addEventListener('loadeddata', () => {
                console.log('–ú—É–∑—ã–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                document.getElementById('startBtn').disabled = false;
            });

            setupControls();
            startRainAnimation();
        }

        function setupControls() {
            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('leftBtn').addEventListener('click', () => movePlayer(-1));
            document.getElementById('rightBtn').addEventListener('click', () => movePlayer(1));
            
            // –¢–∞—á–∏ –∏ —Å–≤–∞–π–ø—ã
            let startX = 0;
            let startY = 0;
            
            document.addEventListener('touchstart', (e) => {
                if (!game.isRunning) return;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', (e) => {
                if (!game.isRunning) return;
                e.preventDefault();
                
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                
                // Swipe detection
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        movePlayer(1); // right
                    } else {
                        movePlayer(-1); // left
                    }
                } else {
                    // Tap –Ω–∞ —Ñ—Ä–∞–∑—É
                    const touchY = endY;
                    checkPhraseCollision(touchY);
                }
            });

            // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.addEventListener('keydown', (e) => {
                if (!game.isRunning) return;
                if (e.key === 'ArrowLeft' || e.key === 'a') movePlayer(-1);
                if (e.key === 'ArrowRight' || e.key === 'd') movePlayer(1);
            });
        }

        function movePlayer(direction) {
            game.playerX = Math.max(20, Math.min(80, game.playerX + direction * 15));
            updatePlayerPosition();
        }

        function updatePlayerPosition() {
            const player = document.getElementById('player');
            player.style.left = game.playerX + '%';
        }

        function checkPhraseCollision(touchY) {
            game.phrases.forEach(phrase => {
                const rect = phrase.getBoundingClientRect();
                if (touchY >= rect.top && touchY <= rect.bottom) {
                    collectPhrase(phrase);
                }
            });
        }

        function startGame() {
            game.isRunning = true;
            game.gameTime = 0;
            game.currentPhraseIndex = 0;
            game.expectedOrder = 1;
            
            document.getElementById('startScreen').style.display = 'none';
            
            const music = document.getElementById('backgroundMusic');
            music.currentTime = 0;
            music.play().catch(e => console.log('–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'));
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–¥–µ–π —Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            startCoinGeneration();
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
            game.gameLoop = setInterval(() => {
                updateGame();
                updateProgress();
                checkForNewPhrases();
            }, 300); // –£–≤–µ–ª–∏—á–∏–ª–∏ —Å 100–º—Å –¥–æ 300–º—Å –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            
            requestAnimationFrame(drawBackground);
        }

        function updateGame() {
            if (!game.isRunning) return;
            
            const music = document.getElementById('backgroundMusic');
            game.gameTime = music.currentTime;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å
            if (game.level === 1 && game.gameTime >= 44 && !game.levelChanged) {
                switchToLevel2();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ç—Ä–µ—Ç–∏–π —É—Ä–æ–≤–µ–Ω—å
            if (game.level === 2 && game.gameTime >= 88 && !game.level3Started) {
                switchToLevel3();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å —Ñ—Ä–∞–∑–∞–º–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞
            checkPlayerCollisions();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å –∏–¥–µ—è–º–∏ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
            checkCoinCollisions();
            
            // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ—Ä–∞–∑—ã
            game.phrases = game.phrases.filter(phrase => {
                if (phrase.offsetTop > window.innerHeight) {
                    if (phrase.parentNode) {
                        phrase.parentNode.removeChild(phrase);
                    }
                    return false;
                }
                return true;
            });
            
            // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∏–¥–µ–∏
            game.coinElements = game.coinElements.filter(coin => {
                if (coin.offsetTop > window.innerHeight) {
                    if (coin.parentNode) {
                        coin.parentNode.removeChild(coin);
                    }
                    return false;
                }
                return true;
            });
        }

        function checkPlayerCollisions() {
            const playerRect = document.getElementById('player').getBoundingClientRect();
            const playerCenterX = playerRect.left + playerRect.width / 2;
            
            game.phrases.forEach(phrase => {
                const phraseRect = phrase.getBoundingClientRect();
                const phraseCenterX = phraseRect.left + phraseRect.width / 2;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ X –∏ Y
                if (Math.abs(playerCenterX - phraseCenterX) < 50 && 
                    phraseRect.bottom >= playerRect.top && 
                    phraseRect.top <= playerRect.bottom) {
                    collectPhrase(phrase);
                }
            });
        }

        function checkForNewPhrases() {
            while (game.currentPhraseIndex < trackPhrases.length && 
                   trackPhrases[game.currentPhraseIndex].timing <= game.gameTime) {
                addPhrase(trackPhrases[game.currentPhraseIndex]);
                game.currentPhraseIndex++;
            }
        }

        function addPhrase(phraseData) {
            const phrase = document.createElement('div');
            let className = `lyric-phrase ${phraseData.type}`;
            
            // –î–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
            if (game.level === 2) {
                className += ' level-2-phrase';
            } else if (game.level === 3) {
                className += ' level-3-phrase';
            }
            
            phrase.className = className;
            phrase.textContent = phraseData.text;
            phrase.dataset.type = phraseData.type;
            phrase.dataset.order = phraseData.order;
            
            // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ X —Å —É—á–µ—Ç–æ–º –≥—Ä–∞–Ω–∏—Ü –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const container = document.getElementById('gameContainer');
            const containerWidth = container.offsetWidth || window.innerWidth;
            const maxLeft = Math.max(10, containerWidth - 250); // –º–∏–Ω 10px –æ—Ç—Å—Ç—É–ø, –º–∞–∫—Å –¥–ª–∏–Ω–∞ —Ñ—Ä–∞–∑—ã 250px
            const randomX = Math.random() * maxLeft;
            phrase.style.left = randomX + 'px';
            
            document.getElementById('gameContainer').appendChild(phrase);
            game.phrases.push(phrase);
        }

        function switchToLevel2() {
            game.level = 2;
            game.levelChanged = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è
            const transition = document.createElement('div');
            transition.className = 'level-transition';
            transition.innerHTML = 'üéµ –£–†–û–í–ï–ù–¨ 2 üéµ<br/>–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ –≤—Ä–∞—â–µ–Ω–∏–µ!';
            
            document.getElementById('gameContainer').appendChild(transition);
            
            // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (transition.parentNode) {
                    transition.parentNode.removeChild(transition);
                }
            }, 3000);
            
            updateUI();
        }

        function switchToLevel3() {
            game.level = 3;
            game.level3Started = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è
            const transition = document.createElement('div');
            transition.className = 'level-transition';
            transition.innerHTML = 'üí° –£–†–û–í–ï–ù–¨ 3 üí°<br/>–•–ê–û–° –ò –ò–î–ï–ò!<br/>–°–≤–µ—Ä—Ö—Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∏—Å–∫–∞–∂–µ–Ω–∏—è!';
            
            document.getElementById('gameContainer').appendChild(transition);
            
            // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (transition.parentNode) {
                    transition.parentNode.removeChild(transition);
                }
            }, 3000);
            
            updateUI();
        }

        function startCoinGeneration() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–¥–µ–∏ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö —Å —Ä–∞–∑–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π
            const coinInterval = setInterval(() => {
                if (!game.isRunning) {
                    clearInterval(coinInterval);
                    return;
                }
                
                // –†–∞–∑–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π (–±–æ–ª–µ–µ —Ä–µ–¥–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
                let chance = 0;
                let delay = 8000; // —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                
                switch(game.level) {
                    case 1:
                        chance = 0.15; // 15% —à–∞–Ω—Å, —Ä–µ–¥–∫–æ
                        delay = 8000 + Math.random() * 4000; // 8-12 —Å–µ–∫
                        break;
                    case 2:
                        chance = 0.3; // 30% —à–∞–Ω—Å, —É–º–µ—Ä–µ–Ω–Ω–æ
                        delay = 5000 + Math.random() * 3000; // 5-8 —Å–µ–∫
                        break;
                    case 3:
                        chance = 0.6; // 60% —à–∞–Ω—Å, —á–∞—Å—Ç–æ
                        delay = 2000 + Math.random() * 2000; // 2-4 —Å–µ–∫
                        break;
                }
                
                if (Math.random() < chance) {
                    addCoin();
                }
            }, 3000 + Math.random() * 2000); // –æ–±—â–∞—è –±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
        }

        function addCoin() {
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ X —Å —É—á–µ—Ç–æ–º –≥—Ä–∞–Ω–∏—Ü
            const container = document.getElementById('gameContainer');
            const containerWidth = container.offsetWidth || window.innerWidth;
            const maxLeft = Math.max(10, containerWidth - 60); // –æ—Ç—Å—Ç—É–ø 10px, —à–∏—Ä–∏–Ω–∞ –º–æ–Ω–µ—Ç–∫–∏ 50px
            const randomX = Math.random() * maxLeft;
            coin.style.left = randomX + 'px';
            
            document.getElementById('gameContainer').appendChild(coin);
            game.coinElements.push(coin);
        }

        function checkCoinCollisions() {
            const playerRect = document.getElementById('player').getBoundingClientRect();
            const playerCenterX = playerRect.left + playerRect.width / 2;
            
            game.coinElements.forEach(coin => {
                const coinRect = coin.getBoundingClientRect();
                const coinCenterX = coinRect.left + coinRect.width / 2;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ X –∏ Y
                if (Math.abs(playerCenterX - coinCenterX) < 40 && 
                    coinRect.bottom >= playerRect.top && 
                    coinRect.top <= playerRect.bottom) {
                    collectCoin(coin);
                }
            });
        }

        function collectCoin(coinElement) {
            if (!coinElement.parentNode) return;
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏–¥–µ–π –∏ –¥–∞–µ–º –±–æ–Ω—É—Å–Ω—ã–µ –æ—á–∫–∏
            game.coins++;
            game.score += 50 * game.combo; // –ò–¥–µ–∏ –¥–∞—é—Ç –º–Ω–æ–≥–æ –æ—á–∫–æ–≤!
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞ –∏–¥–µ–∏
            createCoinEffects(coinElement);
            
            // –£–¥–∞–ª—è–µ–º –∏–¥–µ—é
            coinElement.classList.add('coin-collected');
            game.coinElements = game.coinElements.filter(c => c !== coinElement);
            
            setTimeout(() => {
                if (coinElement.parentNode) {
                    coinElement.parentNode.removeChild(coinElement);
                }
            }, 800);
            
            updateUI();
        }

        function createCoinEffects(coinElement) {
            const rect = coinElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // –°–æ–∑–¥–∞–µ–º –∑–æ–ª–æ—Ç—ã–µ —á–∞—Å—Ç–∏—Ü—ã
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '6px';
                particle.style.height = '6px';
                particle.style.background = 'radial-gradient(circle, #ffd700, #f39c12)';
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '15';
                
                const angle = (i / 8) * Math.PI * 2;
                const distance = 40 + Math.random() * 20;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                
                document.getElementById('gameContainer').appendChild(particle);
                
                // –ê–Ω–∏–º–∏—Ä—É–µ–º —á–∞—Å—Ç–∏—Ü—É
                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${dx}px, ${dy}px) scale(2)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                }).onfinish = () => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                };
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º +50 –æ—á–∫–æ–≤
            const scoreEffect = document.createElement('div');
            scoreEffect.style.position = 'absolute';
            scoreEffect.style.left = (centerX - 20) + 'px';
            scoreEffect.style.top = (centerY - 20) + 'px';
            scoreEffect.style.color = '#f1c40f';
            scoreEffect.style.fontSize = '18px';
            scoreEffect.style.fontWeight = 'bold';
            scoreEffect.style.pointerEvents = 'none';
            scoreEffect.style.zIndex = '20';
            scoreEffect.textContent = '+' + (50 * game.combo);
            
            document.getElementById('gameContainer').appendChild(scoreEffect);
            
            scoreEffect.animate([
                { transform: 'translateY(0) scale(1)', opacity: 1 },
                { transform: 'translateY(-50px) scale(1.2)', opacity: 0 }
            ], {
                duration: 1200,
                easing: 'ease-out'
            }).onfinish = () => {
                if (scoreEffect.parentNode) {
                    scoreEffect.parentNode.removeChild(scoreEffect);
                }
            };
        }

        function collectPhrase(phraseElement) {
            if (!phraseElement.parentNode) return;
            
            const order = parseInt(phraseElement.dataset.order);
            const phraseType = phraseElement.dataset.type;
            
            let points = 1;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ä—è–¥–∫–∞
            if (order === game.expectedOrder) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ - –±–æ–ª—å—à–µ –æ—á–∫–æ–≤
                points = phraseType === 'chorus' ? 5 : phraseType === 'intro' ? 3 : 2;
                game.combo = Math.min(10, game.combo + 1);
                game.expectedOrder++;
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ - –º–µ–Ω—å—à–µ –æ—á–∫–æ–≤ –∏ —Å–±—Ä–æ—Å –∫–æ–º–±–æ
                points = 1;
                game.combo = 1;
            }
            
            game.score += points * game.combo;
            game.collected++;
            game.maxCombo = Math.max(game.maxCombo, game.combo);
            game.lastCollectTime = Date.now();
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–±–æ—Ä–∞
            createCollectEffects(phraseElement);
            
            // –£–¥–∞–ª—è–µ–º —Ñ—Ä–∞–∑—É
            phraseElement.classList.add('collected-phrase');
            game.phrases = game.phrases.filter(p => p !== phraseElement);
            
            setTimeout(() => {
                if (phraseElement.parentNode) {
                    phraseElement.parentNode.removeChild(phraseElement);
                }
            }, 1400);
            
            updateUI();
        }

        function createCollectEffects(phraseElement) {
            const rect = phraseElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'collect-particle';
                
                const angle = (i / 10) * Math.PI * 2;
                const distance = 40 + Math.random() * 20;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.setProperty('--dx', dx + 'px');
                particle.style.setProperty('--dy', dy + 'px');
                
                document.getElementById('gameContainer').appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 1200);
            }
        }



        function updateUI() {
            document.getElementById('collectedCount').textContent = game.collected;
            document.getElementById('scoreCount').textContent = game.score;
            document.getElementById('comboCount').textContent = game.combo;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è
            const levelIndicator = document.getElementById('levelIndicator');
            if (levelIndicator) {
                levelIndicator.textContent = game.level;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏–¥–µ–π (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–∞–Ω–µ–ª—å –≤–∏–¥–Ω–∞)
            const coinCount = document.getElementById('coinCount');
            if (coinCount) {
                coinCount.textContent = game.coins;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            updateSyncPanel();
        }

        function toggleSyncPanel() {
            const panel = document.getElementById('syncPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function updateSyncPanel() {
            if (!game.isRunning) return;
            
            const currentTimeSpan = document.getElementById('currentTime');
            const nextPhraseSpan = document.getElementById('nextPhrase');
            const timeToNextSpan = document.getElementById('timeToNext');
            
            if (currentTimeSpan) {
                const minutes = Math.floor(game.gameTime / 60);
                const seconds = Math.floor(game.gameTime % 60);
                currentTimeSpan.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            if (nextPhraseSpan && timeToNextSpan) {
                const nextPhrase = trackPhrases[game.currentPhraseIndex];
                if (nextPhrase) {
                    nextPhraseSpan.textContent = nextPhrase.text.substring(0, 25) + (nextPhrase.text.length > 25 ? '...' : '');
                    const timeToNext = Math.max(0, nextPhrase.timing - game.gameTime);
                    timeToNextSpan.textContent = timeToNext.toFixed(1);
                } else {
                    nextPhraseSpan.textContent = '–ö–æ–Ω–µ—Ü —Ç—Ä–µ–∫–∞';
                    timeToNextSpan.textContent = '-';
                }
            }
        }

        function updateProgress() {
            const music = document.getElementById('backgroundMusic');
            if (music.duration) {
                const progress = (music.currentTime / music.duration) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }
        }

        function drawBackground() {
            if (!game.isRunning) return;
            
            const ctx = game.ctx;
            const canvas = game.canvas;
            
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(52, 73, 94, 0.3)');
            gradient.addColorStop(0.5, 'rgba(44, 62, 80, 0.2)');
            gradient.addColorStop(1, 'rgba(52, 73, 94, 0.4)');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            requestAnimationFrame(drawBackground);
        }

        function startRainAnimation() {
            if (!game.isRunning) return;
            
            setInterval(() => {
                if (!game.isRunning || Math.random() > 0.3) return;
                
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = Math.random() * window.innerWidth + 'px';
                drop.style.animationDuration = (1.5 + Math.random()) + 's';
                
                document.getElementById('gameContainer').appendChild(drop);
                
                setTimeout(() => {
                    if (drop.parentNode) {
                        drop.parentNode.removeChild(drop);
                    }
                }, 3000);
            }, 200);
        }

        function endGame() {
            game.isRunning = false;
            clearInterval(game.gameLoop);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('finalCollected').textContent = game.collected;
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('finalCombo').textContent = game.maxCombo;
            document.getElementById('finalLevel').textContent = game.level;
            document.getElementById('finalCoins').textContent = game.coins;
            
            document.getElementById('gameOver').style.display = 'flex';
        }

        function restartGame() {
            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            game.score = 0;
            game.combo = 1;
            game.maxCombo = 1;
            game.collected = 0;
            game.coins = 0;
            game.playerX = 50;
            game.currentPhraseIndex = 0;
            game.expectedOrder = 1;
            game.level = 1;
            game.levelChanged = false;
            game.level3Started = false;
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ñ—Ä–∞–∑—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            game.phrases.forEach(phrase => {
                if (phrase.parentNode) phrase.parentNode.removeChild(phrase);
            });
            game.phrases = [];
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –∏–¥–µ–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            game.coinElements.forEach(coin => {
                if (coin.parentNode) coin.parentNode.removeChild(coin);
            });
            game.coinElements = [];
            
            updatePlayerPosition();
            updateUI();
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
        });
    </script>
</body>
</html>